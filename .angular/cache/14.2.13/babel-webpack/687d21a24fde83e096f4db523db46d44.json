{"ast":null,"code":"import { EventEmitter } from '@angular/core'; // Importamos Output y EventEmitter\n\nimport { EMPTY } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/cif-code.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../tree-node/tree-node.component\";\n\nfunction CifTreeComponent_ng_container_1_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\")(1, \"app-tree-node\", 5);\n    i0.ɵɵlistener(\"nodeToggled\", function CifTreeComponent_ng_container_1_li_2_Template_app_tree_node_nodeToggled_1_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.onNodeToggle($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const node_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"node\", node_r5);\n  }\n}\n\nfunction CifTreeComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"ul\", 3);\n    i0.ɵɵtemplate(2, CifTreeComponent_ng_container_1_li_2_Template, 2, 1, \"li\", 4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const nodes_r3 = ctx.ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", nodes_r3);\n  }\n}\n\nfunction CifTreeComponent_ng_template_3_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r8.errorMsg);\n  }\n}\n\nfunction CifTreeComponent_ng_template_3_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Cargando \\u00E1rbol...\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CifTreeComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, CifTreeComponent_ng_template_3_div_0_Template, 3, 1, \"div\", 1);\n    i0.ɵɵtemplate(1, CifTreeComponent_ng_template_3_ng_template_1_Template, 2, 0, \"ng-template\", null, 6, i0.ɵɵtemplateRefExtractor);\n  }\n\n  if (rf & 2) {\n    const _r9 = i0.ɵɵreference(2);\n\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.errorMsg)(\"ngIfElse\", _r9);\n  }\n}\n\nexport class CifTreeComponent {\n  constructor(cifCodeService) {\n    this.cifCodeService = cifCodeService;\n    this.errorMsg = ''; // Este evento enviará la lista final al formulario (CalificacionComponent)\n\n    this.selectionUpdate = new EventEmitter(); // Usamos un Map para guardar los seleccionados por su 'codigo' (es más eficiente)\n\n    this.selectedNodes = new Map();\n  }\n\n  ngOnInit() {\n    this.tree$ = this.cifCodeService.getTree().pipe(catchError(err => {\n      this.errorMsg = 'Error al cargar los datos: ' + err.message;\n      return EMPTY;\n    }));\n  } // Esta función se llamará CADA VEZ que un checkbox (en cualquier nivel) cambie\n\n\n  onNodeToggle(event) {\n    if (event.checked) {\n      // Si está marcado, lo añadimos al Map\n      this.selectedNodes.set(event.node.codigo, event.node);\n    } else {\n      // Si está desmarcado, lo borramos del Map\n      this.selectedNodes.delete(event.node.codigo);\n    } // Convertimos los valores del Map a un array\n\n\n    const selectedList = Array.from(this.selectedNodes.values()); // ¡Emitimos la lista completa hacia el componente padre!\n\n    this.selectionUpdate.emit(selectedList);\n  }\n\n}\n\nCifTreeComponent.ɵfac = function CifTreeComponent_Factory(t) {\n  return new (t || CifTreeComponent)(i0.ɵɵdirectiveInject(i1.CifCodeService));\n};\n\nCifTreeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CifTreeComponent,\n  selectors: [[\"app-cif-tree\"]],\n  outputs: {\n    selectionUpdate: \"selectionUpdate\"\n  },\n  decls: 5,\n  vars: 4,\n  consts: [[1, \"tree-container\"], [4, \"ngIf\", \"ngIfElse\"], [\"loadingOrError\", \"\"], [1, \"tree-root\"], [4, \"ngFor\", \"ngForOf\"], [3, \"node\", \"nodeToggled\"], [\"loading\", \"\"], [1, \"error\"]],\n  template: function CifTreeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtemplate(1, CifTreeComponent_ng_container_1_Template, 3, 1, \"ng-container\", 1);\n      i0.ɵɵpipe(2, \"async\");\n      i0.ɵɵtemplate(3, CifTreeComponent_ng_template_3_Template, 3, 2, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(4);\n\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 2, ctx.tree$))(\"ngIfElse\", _r1);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.TreeNodeComponent, i2.AsyncPipe],\n  styles: [\".tree-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\\r\\n  list-style-type: none; \\r\\n  padding-left: 20px;    \\r\\n}\\r\\n\\r\\n.tree-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\\r\\n  margin: 5px 0;\\r\\n}\\r\\n\\r\\n.tree-container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%] {\\r\\n  color: #333;\\r\\n}\\r\\n\\r\\n.error[_ngcontent-%COMP%] {\\r\\n  color: red;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpZi10cmVlLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNERBQTREOztBQUU1RDtFQUNFLHFCQUFxQixFQUFFLHNCQUFzQjtFQUM3QyxrQkFBa0IsS0FBSyxxQkFBcUI7QUFDOUM7O0FBRUE7RUFDRSxhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxXQUFXO0FBQ2I7O0FBRUE7RUFDRSxVQUFVO0FBQ1oiLCJmaWxlIjoiY2lmLXRyZWUuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIFBvbiBlc3RvIGVuIHN0eWxlcy5jc3MgbyBkaXbDrWRlbG8gZW50cmUgbG9zIGNvbXBvbmVudGVzICovXHJcblxyXG4udHJlZS1jb250YWluZXIgdWwge1xyXG4gIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsgLyogUXVpdGEgbG9zIGJ1bGxldHMgKi9cclxuICBwYWRkaW5nLWxlZnQ6IDIwcHg7ICAgIC8qIMKhTGEgaW5kZW50YWNpw7NuISAqL1xyXG59XHJcblxyXG4udHJlZS1jb250YWluZXIgbGkge1xyXG4gIG1hcmdpbjogNXB4IDA7XHJcbn1cclxuXHJcbi50cmVlLWNvbnRhaW5lciBzdHJvbmcge1xyXG4gIGNvbG9yOiAjMzMzO1xyXG59XHJcblxyXG4uZXJyb3Ige1xyXG4gIGNvbG9yOiByZWQ7XHJcbn0iXX0= */\"]\n});","map":{"version":3,"mappings":"AACA,SAAoCA,YAApC,QAAwD,eAAxD,C,CAAyE;;AACzE,SAAqBC,KAArB,QAAkC,MAAlC;AACA,SAASC,UAAT,QAA2B,gBAA3B;;;;;;;;;;ICEMC,2BAA+B,CAA/B,EAA+B,eAA/B,EAA+B,CAA/B;IAGIA;MAAAA;MAAA;MAAA,OAAeA,2CAAf;IAAmC,CAAnC;IAEFA;;;;;IAHEA;IAAAA;;;;;;IALRA;IAEEA;IACEA;IAOFA;IAEFA;;;;;IATyBA;IAAAA;;;;;;IAavBA,4BAAoC,CAApC,EAAoC,GAApC,EAAoC,CAApC;IACmBA;IAAcA;;;;;IAAdA;IAAAA;;;;;;IAIjBA;IAAGA;IAAiBA;;;;;;IALtBA;IAIAA;;;;;;;IAJMA,uCAAgB,UAAhB,EAAgBC,GAAhB;;;;ADLV,OAAM,MAAOC,gBAAP,CAAuB;EAW3BC,YAAoBC,cAApB,EAAkD;IAA9B;IARb,gBAAmB,EAAnB,CAQ2C,CANlD;;IACU,uBAAkB,IAAIP,YAAJ,EAAlB,CAKwC,CAHlD;;IACQ,qBAAgB,IAAIQ,GAAJ,EAAhB;EAE+C;;EAEvDC,QAAQ;IACN,KAAKC,KAAL,GAAa,KAAKH,cAAL,CAAoBI,OAApB,GAA8BC,IAA9B,CACXV,UAAU,CAACW,GAAG,IAAG;MACf,KAAKC,QAAL,GAAgB,gCAAgCD,GAAG,CAACE,OAApD;MACA,OAAOd,KAAP;IACD,CAHS,CADC,CAAb;EAMD,CApB0B,CAsB3B;;;EACOe,YAAY,CAACC,KAAD,EAAuB;IAExC,IAAIA,KAAK,CAACC,OAAV,EAAmB;MACjB;MACA,KAAKC,aAAL,CAAmBC,GAAnB,CAAuBH,KAAK,CAACI,IAAN,CAAWC,MAAlC,EAA0CL,KAAK,CAACI,IAAhD;IACD,CAHD,MAGO;MACL;MACA,KAAKF,aAAL,CAAmBI,MAAnB,CAA0BN,KAAK,CAACI,IAAN,CAAWC,MAArC;IACD,CARuC,CAUxC;;;IACA,MAAME,YAAY,GAAGC,KAAK,CAACC,IAAN,CAAW,KAAKP,aAAL,CAAmBQ,MAAnB,EAAX,CAArB,CAXwC,CAaxC;;IACA,KAAKC,eAAL,CAAqBC,IAArB,CAA0BL,YAA1B;EACD;;AAtC0B;;;mBAAhBnB,kBAAgBF;AAAA;;;QAAhBE;EAAgByB;EAAAC;IAAAH;EAAA;EAAAI;EAAAC;EAAAC;EAAAC;IAAA;MCb7BhC;MAEEA;;MAcAA;MAYFA;;;;;;MA1BiBA;MAAAA,uDAAoB,UAApB,EAAoBiC,GAApB","names":["EventEmitter","EMPTY","catchError","i0","_r9","CifTreeComponent","constructor","cifCodeService","Map","ngOnInit","tree$","getTree","pipe","err","errorMsg","message","onNodeToggle","event","checked","selectedNodes","set","node","codigo","delete","selectedList","Array","from","values","selectionUpdate","emit","selectors","outputs","decls","vars","consts","template","_r1"],"sourceRoot":"","sources":["D:\\Nueva carpeta\\Shogai-internal\\ultimoAhoraSi\\src\\app\\features\\cif-tree\\cif-tree.component.ts","D:\\Nueva carpeta\\Shogai-internal\\ultimoAhoraSi\\src\\app\\features\\cif-tree\\cif-tree.component.html"],"sourcesContent":["\nimport { Component, OnInit, Output, EventEmitter } from '@angular/core'; // Importamos Output y EventEmitter\nimport { Observable, EMPTY } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { CifNode } from '../../core/models/Cif-code';\nimport { CifCodeService } from '../../core/services/cif-code.service';\nimport { NodeToggleEvent } from '../../core/models/Cif-code'; // Importamos la interfaz\n\n@Component({\n  selector: 'app-cif-tree',\n  templateUrl: './cif-tree.component.html',\n  styleUrls: ['./cif-tree.component.css']\n})\nexport class CifTreeComponent implements OnInit {\n\n  public tree$: Observable<CifNode[]>;\n  public errorMsg: string = '';\n\n  // Este evento enviará la lista final al formulario (CalificacionComponent)\n  @Output() selectionUpdate = new EventEmitter<CifNode[]>();\n\n  // Usamos un Map para guardar los seleccionados por su 'codigo' (es más eficiente)\n  private selectedNodes = new Map<string, CifNode>();\n\n  constructor(private cifCodeService: CifCodeService) { }\n\n  ngOnInit(): void {\n    this.tree$ = this.cifCodeService.getTree().pipe(\n      catchError(err => {\n        this.errorMsg = 'Error al cargar los datos: ' + err.message;\n        return EMPTY;\n      })\n    );\n  }\n\n  // Esta función se llamará CADA VEZ que un checkbox (en cualquier nivel) cambie\n  public onNodeToggle(event: NodeToggleEvent): void {\n    \n    if (event.checked) {\n      // Si está marcado, lo añadimos al Map\n      this.selectedNodes.set(event.node.codigo, event.node);\n    } else {\n      // Si está desmarcado, lo borramos del Map\n      this.selectedNodes.delete(event.node.codigo);\n    }\n\n    // Convertimos los valores del Map a un array\n    const selectedList = Array.from(this.selectedNodes.values());\n    \n    // ¡Emitimos la lista completa hacia el componente padre!\n    this.selectionUpdate.emit(selectedList);\n  }\n}","<div class=\"tree-container\">\n  \n  <ng-container *ngIf=\"tree$ | async as nodes; else loadingOrError\">\n    \n    <ul class=\"tree-root\">\n      <li *ngFor=\"let node of nodes\">\n        <app-tree-node \n          [node]=\"node\"\n          (nodeToggled)=\"onNodeToggle($event)\"\n        >\n        </app-tree-node>\n      </li>\n    </ul>\n\n  </ng-container>\n\n  <ng-template #loadingOrError>\n    \n    <div *ngIf=\"errorMsg; else loading\">\n      <p class=\"error\">{{ errorMsg }}</p>\n    </div>\n\n    <ng-template #loading>\n      <p>Cargando árbol...</p>\n    </ng-template>\n\n  </ng-template>\n\n</div>"]},"metadata":{},"sourceType":"module"}