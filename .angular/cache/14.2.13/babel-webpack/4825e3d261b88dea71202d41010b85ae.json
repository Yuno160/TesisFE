{"ast":null,"code":"import { FormGroup, FormBuilder, FormArray } from '@angular/forms'; // Asegúrate de tener FormArray\n\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../tree-node/tree-node.component\";\n\nfunction CalificacionComponent_ng_container_3_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\")(1, \"app-tree-node\", 5);\n    i0.ɵɵlistener(\"nodeToggled\", function CalificacionComponent_ng_container_3_li_2_Template_app_tree_node_nodeToggled_1_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.onNodeToggle($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const node_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"node\", node_r5);\n  }\n}\n\nfunction CalificacionComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"ul\", 3);\n    i0.ɵɵtemplate(2, CalificacionComponent_ng_container_3_li_2_Template, 2, 1, \"li\", 4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const nodes_r3 = ctx.ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", nodes_r3);\n  }\n}\n\nfunction CalificacionComponent_ng_template_5_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r8.errorMsg);\n  }\n}\n\nfunction CalificacionComponent_ng_template_5_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Cargando \\u00E1rbol...\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CalificacionComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, CalificacionComponent_ng_template_5_div_0_Template, 3, 1, \"div\", 1);\n    i0.ɵɵtemplate(1, CalificacionComponent_ng_template_5_ng_template_1_Template, 2, 0, \"ng-template\", null, 6, i0.ɵɵtemplateRefExtractor);\n  }\n\n  if (rf & 2) {\n    const _r9 = i0.ɵɵreference(2);\n\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.errorMsg)(\"ngIfElse\", _r9);\n  }\n} // ... (Tus otros imports: ActivatedRoute, PacienteService, etc.)\n\n\nexport class CalificacionComponent {\n  // ... (Tus otras variables: paciente, etc.)\n  constructor(fb\n  /*, ... tus otros servicios */\n  ) {\n    this.fb = fb;\n  }\n\n  ngOnInit() {\n    // ... (Tu lógica para cargar el paciente)\n    // Inicializamos el formulario\n    this.calificacionForm = this.fb.group({\n      pacienteId: [null],\n      observaciones: [''],\n      // Creamos un FormArray para guardar los códigos seleccionados\n      cifCodes: this.fb.array([])\n    });\n  } // Esta es la función que se llama desde el HTML\n\n\n  onTreeSelectionChange(selectedNodes) {\n    // Obtenemos la referencia al FormArray\n    const cifCodesArray = this.calificacionForm.get('cifCodes'); // 1. Limpiamos el array (la forma más fácil de sincronizar)\n\n    cifCodesArray.clear(); // 2. Volvemos a llenar el array solo con los códigos (o el objeto entero, como prefieras)\n\n    selectedNodes.forEach(node => {\n      // Aquí puedes guardar solo el código, o el objeto entero\n      // Voy a guardar solo el código para el ejemplo:\n      cifCodesArray.push(this.fb.control(node.codigo)); // Si quisieras guardar el objeto entero:\n      // cifCodesArray.push(this.fb.control({ codigo: node.codigo, descripcion: node.descripcion }));\n    }); // Opcional: ver por consola cómo se actualiza el formulario\n    // console.log('Formulario actualizado:', this.calificacionForm.value);\n  }\n\n  guardarCalificacion() {\n    if (this.calificacionForm.valid) {\n      console.log('Enviando al Back-End:', this.calificacionForm.value); // Aquí va tu lógica de envío al BE\n      // El this.calificacionForm.value ya incluye el array 'cifCodes'\n    }\n  }\n\n}\n\nCalificacionComponent.ɵfac = function CalificacionComponent_Factory(t) {\n  return new (t || CalificacionComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder));\n};\n\nCalificacionComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CalificacionComponent,\n  selectors: [[\"app-calificacion\"]],\n  decls: 7,\n  vars: 4,\n  consts: [[1, \"tree-container\"], [4, \"ngIf\", \"ngIfElse\"], [\"loadingOrError\", \"\"], [1, \"tree-root\"], [4, \"ngFor\", \"ngForOf\"], [3, \"node\", \"nodeToggled\"], [\"loading\", \"\"], [1, \"error\"]],\n  template: function CalificacionComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h3\");\n      i0.ɵɵtext(1, \"Seleccione los C\\u00F3digos CIF correspondientes:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\", 0);\n      i0.ɵɵtemplate(3, CalificacionComponent_ng_container_3_Template, 3, 1, \"ng-container\", 1);\n      i0.ɵɵpipe(4, \"async\");\n      i0.ɵɵtemplate(5, CalificacionComponent_ng_template_5_Template, 3, 2, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(6);\n\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(4, 2, ctx.tree$))(\"ngIfElse\", _r1);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.TreeNodeComponent, i2.AsyncPipe],\n  styles: [\".calificacion-container[_ngcontent-%COMP%] {\\r\\n    padding: 20px;\\r\\n\\r\\n    h1 {\\r\\n        margin-bottom: 20px;\\r\\n    }\\r\\n\\r\\n    mat-accordion {\\r\\n        margin-bottom: 10px;\\r\\n    }\\r\\n\\r\\n    button {\\r\\n        margin-top: 20px;\\r\\n    }\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGlmaWNhY2lvbi5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBQ0ksYUFBYTs7SUFFYjtRQUNJLG1CQUFtQjtJQUN2Qjs7SUFFQTtRQUNJLG1CQUFtQjtJQUN2Qjs7SUFFQTtRQUNJLGdCQUFnQjtJQUNwQjtBQUNKIiwiZmlsZSI6ImNhbGlmaWNhY2lvbi5jb21wb25lbnQuY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmNhbGlmaWNhY2lvbi1jb250YWluZXIge1xyXG4gICAgcGFkZGluZzogMjBweDtcclxuXHJcbiAgICBoMSB7XHJcbiAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDtcclxuICAgIH1cclxuXHJcbiAgICBtYXQtYWNjb3JkaW9uIHtcclxuICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4O1xyXG4gICAgfVxyXG5cclxuICAgIGJ1dHRvbiB7XHJcbiAgICAgICAgbWFyZ2luLXRvcDogMjBweDtcclxuICAgIH1cclxufSJdfQ== */\"]\n});","map":{"version":3,"mappings":"AAwDA,SAASA,SAAT,EAAoBC,WAApB,EAA6CC,SAA7C,QAA8D,gBAA9D,C,CAAgF;;;;;;;;;;;IC1B1EC,2BAA+B,CAA/B,EAA+B,eAA/B,EAA+B,CAA/B;IAGIA;MAAAA;MAAA;MAAA,OAAeA,2CAAf;IAAmC,CAAnC;IAEFA;;;;;IAHEA;IAAAA;;;;;;IALRA;IAEEA;IACEA;IAOFA;IAEFA;;;;;IATyBA;IAAAA;;;;;;IAavBA,4BAAoC,CAApC,EAAoC,GAApC,EAAoC,CAApC;IACmBA;IAAcA;;;;;IAAdA;IAAAA;;;;;;IAIjBA;IAAGA;IAAiBA;;;;;;IALtBA;IAIAA;;;;;;;IAJMA,uCAAgB,UAAhB,EAAgBC,GAAhB;;EDeV;;;AAOA,OAAM,MAAOC,qBAAP,CAA4B;EAGhC;EAEAC,YAAoBC;EAAgB;EAApC,EAAkE;IAA9C;EAAmD;;EAEvEC,QAAQ;IACN;IAEA;IACA,KAAKC,gBAAL,GAAwB,KAAKF,EAAL,CAAQG,KAAR,CAAc;MACpCC,UAAU,EAAE,CAAC,IAAD,CADwB;MAEpCC,aAAa,EAAE,CAAC,EAAD,CAFqB;MAGpC;MACAC,QAAQ,EAAE,KAAKN,EAAL,CAAQO,KAAR,CAAc,EAAd;IAJ0B,CAAd,CAAxB;EAMD,CAjB+B,CAmBhC;;;EACAC,qBAAqB,CAACC,aAAD,EAAyB;IAE5C;IACA,MAAMC,aAAa,GAAG,KAAKR,gBAAL,CAAsBS,GAAtB,CAA0B,UAA1B,CAAtB,CAH4C,CAK5C;;IACAD,aAAa,CAACE,KAAd,GAN4C,CAQ5C;;IACAH,aAAa,CAACI,OAAd,CAAsBC,IAAI,IAAG;MAC3B;MACA;MACAJ,aAAa,CAACK,IAAd,CAAmB,KAAKf,EAAL,CAAQgB,OAAR,CAAgBF,IAAI,CAACG,MAArB,CAAnB,EAH2B,CAK3B;MACA;IACD,CAPD,EAT4C,CAkB5C;IACA;EACD;;EAEDC,mBAAmB;IACjB,IAAI,KAAKhB,gBAAL,CAAsBiB,KAA1B,EAAiC;MAC/BC,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqC,KAAKnB,gBAAL,CAAsBoB,KAA3D,EAD+B,CAE/B;MACA;IACD;EACF;;AAhD+B;;;mBAArBxB,uBAAqBF;AAAA;;;QAArBE;EAAqByB;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MC1ClC/B;MAAIA;MAA4CA;MAEhDA;MAEEA;;MAcAA;MAYFA;;;;;;MA1BiBA;MAAAA,uDAAoB,UAApB,EAAoBgC,GAApB","names":["FormGroup","FormBuilder","FormArray","i0","_r9","CalificacionComponent","constructor","fb","ngOnInit","calificacionForm","group","pacienteId","observaciones","cifCodes","array","onTreeSelectionChange","selectedNodes","cifCodesArray","get","clear","forEach","node","push","control","codigo","guardarCalificacion","valid","console","log","value","selectors","decls","vars","consts","template","_r1"],"sourceRoot":"","sources":["D:\\Nueva carpeta\\Shogai-internal\\ultimoAhoraSi\\src\\app\\features\\calificacion\\calificacion.component.ts","D:\\Nueva carpeta\\Shogai-internal\\ultimoAhoraSi\\src\\app\\features\\calificacion\\calificacion.component.html"],"sourcesContent":["/* import { Component, OnInit } from '@angular/core';\nimport { CalificacionService } from '../../core/services/calificacion.service';\nimport { Pregunta } from '../../core/models/Pregunta';\nimport { Respuesta } from '../../core/models/Respuesta';\n\n@Component({\n  selector: 'app-calificacion',\n  templateUrl: './calificacion.component.html',\n  styleUrls: ['./calificacion.component.css']\n})\nexport class CalificacionComponent implements OnInit {\n  preguntas: Pregunta[] = [];\n  respuestas: Respuesta[] = [];\n  constructor(private calificacionService: CalificacionService) {}\n\n  ngOnInit(): void {\n    this.obtenerPreguntas();\n}\n\nobtenerPreguntas(): void {\n    this.calificacionService.getPreguntas().subscribe(\n        (data) => this.preguntas = data,\n        (error) => console.error('Error al obtener preguntas:', error)\n    );\n}\n\nresponderPregunta(idPregunta: number, valor: number): void {\n    const respuestaExistente = this.respuestas.find(r => r.id_pregunta === idPregunta);\n    if (respuestaExistente) {\n        respuestaExistente.valor = valor;\n    } else {\n        this.respuestas.push({ id_pregunta: idPregunta, valor });\n    }\n}\n\nenviarRespuestas(): void {\n    this.calificacionService.enviarRespuestas(this.respuestas).subscribe(\n        (response) => console.log('Respuestas enviadas:', response),\n        (error) => console.error('Error al enviar respuestas:', error)\n    );\n}\n\nobtenerTextoRespuesta(valor: number): string {\n  switch (valor) {\n      case 0: return 'Sin dificultad';\n      case 1: return 'Leve';\n      case 2: return 'Moderada';\n      case 3: return 'Severa';\n      default: return '';\n  }\n}\n} */\n\n// src/app/calificacion/calificacion.component.ts\n\nimport { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators, FormArray } from '@angular/forms'; // Asegúrate de tener FormArray\nimport { CifNode } from '../../core/models/Cif-code';\n// ... (Tus otros imports: ActivatedRoute, PacienteService, etc.)\n\n@Component({\n  selector: 'app-calificacion',\n  templateUrl: './calificacion.component.html',\n  styleUrls: ['./calificacion.component.css']\n})\nexport class CalificacionComponent implements OnInit {\n\n  calificacionForm: FormGroup;\n  // ... (Tus otras variables: paciente, etc.)\n\n  constructor(private fb: FormBuilder /*, ... tus otros servicios */) { }\n\n  ngOnInit(): void {\n    // ... (Tu lógica para cargar el paciente)\n\n    // Inicializamos el formulario\n    this.calificacionForm = this.fb.group({\n      pacienteId: [null],\n      observaciones: [''],\n      // Creamos un FormArray para guardar los códigos seleccionados\n      cifCodes: this.fb.array([]) \n    });\n  }\n\n  // Esta es la función que se llama desde el HTML\n  onTreeSelectionChange(selectedNodes: CifNode[]): void {\n    \n    // Obtenemos la referencia al FormArray\n    const cifCodesArray = this.calificacionForm.get('cifCodes') as FormArray;\n\n    // 1. Limpiamos el array (la forma más fácil de sincronizar)\n    cifCodesArray.clear();\n\n    // 2. Volvemos a llenar el array solo con los códigos (o el objeto entero, como prefieras)\n    selectedNodes.forEach(node => {\n      // Aquí puedes guardar solo el código, o el objeto entero\n      // Voy a guardar solo el código para el ejemplo:\n      cifCodesArray.push(this.fb.control(node.codigo));\n      \n      // Si quisieras guardar el objeto entero:\n      // cifCodesArray.push(this.fb.control({ codigo: node.codigo, descripcion: node.descripcion }));\n    });\n\n    // Opcional: ver por consola cómo se actualiza el formulario\n    // console.log('Formulario actualizado:', this.calificacionForm.value);\n  }\n\n  guardarCalificacion(): void {\n    if (this.calificacionForm.valid) {\n      console.log('Enviando al Back-End:', this.calificacionForm.value);\n      // Aquí va tu lógica de envío al BE\n      // El this.calificacionForm.value ya incluye el array 'cifCodes'\n    }\n  }\n}","<!-- <div class=\"calificacion-container\">\n    <h1>Calificación del Paciente</h1>\n\n    <mat-accordion *ngFor=\"let pregunta of preguntas\">\n        <mat-expansion-panel>\n            <mat-expansion-panel-header>\n                <mat-panel-title>\n                    {{ pregunta.texto_pregunta }}\n                </mat-panel-title>\n            </mat-expansion-panel-header>\n\n            <mat-radio-group (change)=\"responderPregunta(pregunta.id_pregunta, $event.value)\">\n                <mat-radio-button *ngFor=\"let valor of [0, 1, 2, 3]\" [value]=\"valor\">\n                    {{ obtenerTextoRespuesta(valor) }}\n                </mat-radio-button>\n            </mat-radio-group>\n        </mat-expansion-panel>\n    </mat-accordion>\n\n    <button mat-raised-button color=\"primary\" (click)=\"enviarRespuestas()\">\n        Enviar Respuestas\n    </button>\n</div> -->\n<h3>Seleccione los Códigos CIF correspondientes:</h3>\n    \n<div class=\"tree-container\">\n  \n  <ng-container *ngIf=\"tree$ | async as nodes; else loadingOrError\">\n    \n    <ul class=\"tree-root\">\n      <li *ngFor=\"let node of nodes\">\n        <app-tree-node \n          [node]=\"node\"\n          (nodeToggled)=\"onNodeToggle($event)\"\n        >\n        </app-tree-node>\n      </li>\n    </ul>\n\n  </ng-container>\n\n  <ng-template #loadingOrError>\n    \n    <div *ngIf=\"errorMsg; else loading\">\n      <p class=\"error\">{{ errorMsg }}</p>\n    </div>\n\n    <ng-template #loading>\n      <p>Cargando árbol...</p>\n    </ng-template>\n\n  </ng-template>\n\n</div>"]},"metadata":{},"sourceType":"module"}